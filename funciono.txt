import scrapy
from scrapers.items import CarItem

class CarOneSpider(scrapy.Spider):
    name = 'carone'
    allowed_domains = ['carone.com.uy']
    start_urls = ['https://carone.com.uy/autos-usados-y-0km']

    def parse(self, response):
        cars = response.xpath('//a[@class="link-primary"]/@href').getall()
        for car_link in cars:
            yield response.follow(car_link, callback=self.parse_car)

    def parse_car(self, response):
        car_id = response.url.split('/')[-1]
        car_item = CarItem(
            id=car_id,
            url=response.url,
            price=response.css('span.price-wrapper span.price::text').get(),
            year=response.xpath('//p[contains(text(), "Año")]/preceding-sibling::p/text()').get(),
            kilometers=response.xpath('//p[contains(text(), "Kilómetros")]/preceding-sibling::p/text()').get(),
            source="Concesionaria Car One"
        )
        yield car_item